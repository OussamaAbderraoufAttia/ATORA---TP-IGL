<header class="bg-blue-600 text-white p-4">
  <div class="container mx-auto flex justify-between items-center">
    <h1 class="text-2xl font-bold">Laborantin Dashboard</h1>
    <nav>
      <ul class="flex space-x-4">
        <button
          class="bg-white text-blue-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition"
          (click)="navigateToProfile()"
        >
          Profile
        </button>
      </ul>
    </nav>
  </div>
</header>

<main class="container mx-auto p-4">
  <div class="w-full max-w-4xl mx-auto shadow-lg bg-white rounded-lg">
    <div class="p-6">
      <h2 class="text-3xl font-bold mb-6">Laborantin Dashboard</h2>
      <div class="w-full">
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-xl font-bold mb-4">Bilans Biologiques</h3>
          <table class="min-w-full bg-white">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b text-left">Description</th>
                <th class="py-2 px-4 border-b text-left">Date</th>
                <th class="py-2 px-4 border-b text-left">Parameters</th>
                <th class="py-2 px-4 border-b text-left">Status</th>
                <th class="py-2 px-4 border-b text-left">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bilan of bilans">
                <td class="py-2 px-4 border-b">{{ bilan.description }}</td>
                <td class="py-2 px-4 border-b">{{ bilan.date }}</td>
                <td class="py-2 px-4 border-b">
                  <ul>
                    <li *ngFor="let mesure of bilan.mesures">{{ mesure.param }}: {{ mesure.valeur }}</li>
                  </ul>
                </td>
                <td class="py-2 px-4 border-b">{{ bilan.status }}</td>
                <td class="py-2 px-4 border-b">
                  <button
                    class="bg-blue-500 text-white px-4 py-2 rounded"
                    (click)="openDialog(bilan)"
                  >
                    {{ bilan.status === 'done' ? 'Show More' : 'Update Status' }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Dialog -->
<div
  *ngIf="showDialog"
  class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4"
>
  <div class="bg-white rounded-lg p-6 w-full max-w-screen-sm shadow-lg overflow-y-auto max-h-[90vh]">
    <h2 class="text-xl font-bold mb-4">
      {{ selectedBilan?.status === 'done' ? 'Bilan Details' : 'Update Bilan' }}
    </h2>

    <!-- Bilan Info -->
    <div class="mb-6 bg-gray-50 p-4 rounded">
      <h3 class="font-semibold text-lg mb-2">Bilan Information</h3>
      <p class="mb-2"><span class="font-medium">Description:</span> {{ selectedBilan?.description }}</p>
      <p><span class="font-medium">Date:</span> {{ selectedBilan?.date }}</p>
    </div>

    <!-- Mesures Table -->
    <table class="min-w-full bg-white mb-4">
      <thead>
        <tr>
          <th class="py-2 px-4 border-b">Parameter</th>
          <th class="py-2 px-4 border-b">Value</th>
          <th class="py-2 px-4 border-b">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let mesure of selectedBilan?.mesures; let i = index">
          <td class="py-2 px-4 border-b">
            <input
              *ngIf="selectedBilan?.status !== 'done'; else displayParam"
              [(ngModel)]="mesure.param"
              class="w-full p-2 border rounded"
              placeholder="Enter parameter"
            />
            <ng-template #displayParam>{{ mesure.param }}</ng-template>
          </td>
          <td class="py-2 px-4 border-b">
            <input
              *ngIf="selectedBilan?.status !== 'done'; else displayValeur"
              [(ngModel)]="mesure.valeur"
              (ngModelChange)="onMesureValueChange()"
              class="w-full p-2 border rounded"
              placeholder="Enter value"
            />
            <ng-template #displayValeur>{{ mesure.valeur }}</ng-template>
          </td>
          <td class="py-2 px-4 border-b">
            <button
              *ngIf="selectedBilan?.status !== 'done'"
              class="bg-red-500 text-white px-4 py-2 rounded"
              (click)="removeMesure(i)"
            >
              Remove
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Add Mesure Button -->
    <button
      *ngIf="selectedBilan?.status !== 'done'"
      class="bg-blue-500 text-white px-4 py-2 rounded mb-4"
      (click)="addMesure()"
    >
      Add Parameter
    </button>

    <!-- Graph Display -->
    <div *ngIf="generateGraph || selectedBilan?.status === 'done'" class="mt-4" style="height: 300px;">
      <canvas id="bilanChart"></canvas>
    </div>

    <!-- Buttons -->
    <div class="flex justify-end space-x-4 mt-6">
      <button
        class="bg-gray-500 text-white px-4 py-2 rounded"
        (click)="closeDialog()"
      >
        Close
      </button>
      <button
        *ngIf="selectedBilan?.status !== 'done'"
        class="bg-blue-500 text-white px-4 py-2 rounded"
        (click)="updateStatus()"
      >
        Update
      </button>
    </div>
  </div>
</div>

<footer class="bg-blue-600 text-white p-4 mt-8">
  <div class="container mx-auto text-center">
    <p>Â© 2023 Laborantin Dashboard. All rights reserved.</p>
  </div>
</footer>